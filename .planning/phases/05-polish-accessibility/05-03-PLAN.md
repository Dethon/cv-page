---
phase: 05-polish-accessibility
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - vite.config.ts
autonomous: true

must_haves:
  truths:
    - "Site achieves Lighthouse performance score of 90+ on production build"
    - "Production build creates optimized chunks with vendor splitting"
    - "Build output is under 500KB total (excluding source maps)"
  artifacts:
    - path: "vite.config.ts"
      provides: "Manual chunk splitting for react-vendor and react-icons"
      contains: "manualChunks"
  key_links:
    - from: "vite.config.ts"
      to: "dist/"
      via: "build output"
      pattern: "manualChunks"
---

<objective>
Optimize production build for Lighthouse performance score above 90.

Purpose: The final phase success criterion requires Lighthouse performance > 90. This plan configures Vite for optimal chunk splitting and verifies the production build is performant.
Output: Optimized vite.config.ts with vendor chunking, verified production build with size analysis.
</objective>

<execution_context>
@/home/dethon/.claude/get-shit-done/workflows/execute-plan.md
@/home/dethon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-polish-accessibility/05-RESEARCH.md
@vite.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Vite build optimization and verify production build</name>
  <files>vite.config.ts</files>
  <action>
    1. Update `vite.config.ts` to add manual chunk splitting in build.rollupOptions.output:
       ```typescript
       build: {
         rollupOptions: {
           output: {
             manualChunks: {
               'react-vendor': ['react', 'react-dom', 'react-helmet-async'],
               'react-icons': ['react-icons/fa', 'react-icons/si', 'react-icons/md'],
             },
           },
         },
       }
       ```
       Keep existing `plugins: [react()]` and `base: '/cv-page/'`.

    2. Run `npm run build` and analyze the output:
       - Check total bundle size (should be well under 500KB for a simple portfolio)
       - Verify chunks are split (react-vendor separate from app code)
       - Ensure no build warnings about chunk size

    3. Run `npx vite preview` briefly to confirm the production build serves correctly (then kill the process).

    4. Verify the production build includes:
       - Hashed filenames for cache busting
       - CSS extracted and minified
       - JS minified and tree-shaken
       - Meta tags present in dist/index.html

    5. Run Lighthouse performance audit against the preview server:
       - Start preview server in background: `npx vite preview &`
       - Run Lighthouse CLI: `npx lighthouse http://localhost:4173/cv-page/ --only-categories=performance --output=json --chrome-flags="--headless --no-sandbox"` and parse the performance score from the JSON output
       - Verify score >= 0.90 (which is 90+)
       - Kill the preview server process
       - If Lighthouse CLI is not available or fails in headless mode, document the build metrics (bundle size, chunk count) and flag for manual Lighthouse verification
  </action>
  <verify>`npm run build` succeeds. `ls -la dist/assets/` shows multiple chunks. `du -sh dist/` under 500KB. Lighthouse performance score >= 90 (or documented for manual verification if headless Lighthouse unavailable).</verify>
  <done>Production build creates optimized chunks. Total build size is under 500KB. Lighthouse performance score verified >= 90.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds without errors
- `ls dist/assets/` shows separate vendor chunk files
- `du -sh dist/` shows total size under 500KB
- dist/index.html contains meta tags (og:title, description)
- All CSS is minified in dist/assets/*.css
- Lighthouse performance score >= 90 verified against production build
</verification>

<success_criteria>
- Vite config has manual chunk splitting for react ecosystem and react-icons
- Production build creates separate vendor chunks for better caching
- Total build output is under 500KB
- Lighthouse performance score is 90+ on production build
- Production build serves correctly via preview
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish-accessibility/05-03-SUMMARY.md`
</output>
