---
phase: 02-layout-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - src/styles/theme.css
  - src/index.css
  - src/hooks/useTheme.ts
  - src/components/ThemeToggle.tsx
autonomous: true

must_haves:
  truths:
    - "Dark and light theme color tokens are defined as CSS custom properties"
    - "Theme toggles when data-theme attribute changes on documentElement"
    - "useTheme hook reads from localStorage, falls back to system preference, defaults to light"
    - "Theme preference persists in localStorage across page refresh"
    - "No flash of wrong theme on initial page load (FOUC prevention)"
    - "ThemeToggle button has accessible aria-label describing the action"
  artifacts:
    - path: "src/styles/theme.css"
      provides: "CSS custom properties for light and dark themes"
      contains: "data-theme"
    - path: "src/hooks/useTheme.ts"
      provides: "Theme state management with localStorage persistence"
      exports: ["useTheme"]
    - path: "src/components/ThemeToggle.tsx"
      provides: "Toggle button for switching themes"
      exports: ["ThemeToggle"]
    - path: "index.html"
      provides: "FOUC prevention inline script"
      contains: "data-theme"
    - path: "src/index.css"
      provides: "Global base styles with smooth scroll and scroll-padding"
      contains: "scroll-behavior"
  key_links:
    - from: "src/hooks/useTheme.ts"
      to: "document.documentElement"
      via: "setAttribute('data-theme', theme)"
      pattern: "setAttribute.*data-theme"
    - from: "src/hooks/useTheme.ts"
      to: "localStorage"
      via: "getItem/setItem"
      pattern: "localStorage\\.(get|set)Item.*theme"
    - from: "index.html"
      to: "document.documentElement"
      via: "inline script setting data-theme before React mounts"
      pattern: "setAttribute.*data-theme"
    - from: "src/styles/theme.css"
      to: "src/index.css"
      via: "CSS custom properties consumed by global styles"
      pattern: "var\\(--"
---

<objective>
Create the theme infrastructure for dark/light mode support, including CSS custom properties, the useTheme React hook, the ThemeToggle button component, and FOUC prevention.

Purpose: Establishes the visual foundation that all subsequent components will build on. CSS custom properties defined here are consumed by every component's styles. The FOUC prevention script ensures no jarring flash on load.

Output: Theme system files (theme.css, useTheme.ts, ThemeToggle.tsx), updated global styles (index.css), and FOUC prevention script in index.html.
</objective>

<execution_context>
@/home/dethon/.claude/get-shit-done/workflows/execute-plan.md
@/home/dethon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-layout-navigation/02-RESEARCH.md

@index.html
@src/index.css
@src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create theme CSS variables and global base styles</name>
  <files>
    src/styles/theme.css
    src/index.css
    index.html
  </files>
  <action>
1. Create `src/styles/theme.css` with CSS custom properties for both themes:
   - `:root` block (light mode default): `--bg-primary: #ffffff`, `--bg-secondary: #f3f4f6`, `--text-primary: #111827`, `--text-secondary: #6b7280`, `--accent: #3b82f6`, `--accent-hover: #2563eb`, `--border: #e5e7eb`, `--nav-bg: rgba(255, 255, 255, 0.95)`, `--shadow: rgba(0, 0, 0, 0.1)`
   - `[data-theme='dark']` block: `--bg-primary: #0f172a`, `--bg-secondary: #1e293b`, `--text-primary: #f1f5f9`, `--text-secondary: #94a3b8`, `--accent: #60a5fa`, `--accent-hover: #93bbfc`, `--border: #334155`, `--nav-bg: rgba(15, 23, 42, 0.95)`, `--shadow: rgba(0, 0, 0, 0.3)`
   - `body` rule: `background-color: var(--bg-primary)`, `color: var(--text-primary)`, `transition: background-color 0.3s ease, color 0.3s ease`
   - `@media (prefers-reduced-motion: reduce)` rule: disable transitions on body

2. Update `src/index.css`:
   - Keep existing CSS reset (box-sizing, margin, padding, font-family, line-height, font-smoothing)
   - Add `@import './styles/theme.css';` at the top (Vite resolves relative imports in CSS)
   - Add to `html`: `scroll-behavior: smooth`, `scroll-padding-top: 80px` (nav height + spacing)
   - Add `@media (prefers-reduced-motion: reduce) { html { scroll-behavior: auto; } }`
   - Add `a` reset: `color: var(--accent)`, `text-decoration: none`
   - Add `a:hover` rule: `color: var(--accent-hover)`

3. Add FOUC prevention inline script to `index.html`, placed BEFORE the `<div id="root">`:
   ```html
   <script>
     (function() {
       var stored = localStorage.getItem('theme');
       var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
       var theme = stored || (prefersDark ? 'dark' : 'light');
       document.documentElement.setAttribute('data-theme', theme);
     })();
   </script>
   ```
   This must execute synchronously before React mounts to prevent FOUC.
   Use `var` not `const`/`let` for maximum browser compatibility in inline scripts.
  </action>
  <verify>
    Run `npm run build` -- should complete without errors. Inspect `dist/index.html` to confirm the inline FOUC script is present before the root div. Verify `dist/assets/*.css` contains both `:root` and `[data-theme='dark']` selectors.
  </verify>
  <done>
    theme.css defines light/dark CSS custom properties via :root and [data-theme='dark']. index.css imports theme.css and sets scroll-behavior: smooth + scroll-padding-top: 80px. index.html contains inline FOUC prevention script before React root. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useTheme hook and ThemeToggle component</name>
  <files>
    src/hooks/useTheme.ts
    src/components/ThemeToggle.tsx
  </files>
  <action>
1. Create `src/hooks/useTheme.ts`:
   - Export `type Theme = 'light' | 'dark'`
   - Export `function useTheme()` returning `{ theme: Theme, toggleTheme: () => void }`
   - Initialize state with lazy initializer: check `localStorage.getItem('theme')` first, then `window.matchMedia('(prefers-color-scheme: dark)').matches`, default to `'light'`
   - useEffect on `[theme]`: call `document.documentElement.setAttribute('data-theme', theme)` and `localStorage.setItem('theme', theme)`
   - `toggleTheme` flips between 'light' and 'dark'
   - Do NOT use Context API -- simple hook is sufficient per research recommendation

2. Create `src/components/ThemeToggle.tsx`:
   - Import and use `useTheme` from `../hooks/useTheme`
   - Render a `<button>` with `onClick={toggleTheme}`
   - Set `aria-label` to `Switch to ${theme === 'light' ? 'dark' : 'light'} mode`
   - Display a sun/moon icon: use Unicode characters (light mode shows a moon character, dark mode shows a sun character). Do NOT use emoji -- use simple text or SVG icons for cross-platform consistency. Suggestion: render inline SVG icons (a simple circle+rays for sun, crescent for moon) or text labels like "Dark" / "Light"
   - Add `className="theme-toggle"` for styling
   - Style the button in a `<style>` block or CSS module: no border, transparent background, cursor pointer, `color: var(--text-secondary)`, padding 0.5rem, border-radius 0.5rem, hover state with `color: var(--text-primary)`
  </action>
  <verify>
    Run `npx tsc --noEmit` -- should pass with no type errors. Run `npm run build` -- should succeed. Check that `useTheme` exports `Theme` type and `useTheme` function. Check that ThemeToggle imports from useTheme and renders a button with aria-label.
  </verify>
  <done>
    useTheme hook manages theme state with localStorage persistence and system preference detection. ThemeToggle renders an accessible button that toggles between light and dark mode. Both files pass TypeScript type checking and build.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds without errors
2. `npx tsc --noEmit` passes (no type errors)
3. `dist/index.html` contains FOUC prevention script before root div
4. `dist/assets/*.css` contains CSS custom properties for both :root and [data-theme='dark']
5. `src/hooks/useTheme.ts` exports useTheme function
6. `src/components/ThemeToggle.tsx` exports ThemeToggle component with aria-label
</verification>

<success_criteria>
- Theme CSS custom properties define both light and dark color palettes via data-theme attribute
- useTheme hook reads localStorage > system preference > default light, persists on change
- ThemeToggle component provides accessible toggle button
- FOUC prevention script in index.html sets data-theme before React mounts
- Global styles include smooth scroll behavior and scroll-padding-top for sticky nav offset
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-navigation/02-01-SUMMARY.md`
</output>
