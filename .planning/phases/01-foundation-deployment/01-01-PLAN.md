---
phase: 01-foundation-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - vite.config.ts
  - tsconfig.json
  - tsconfig.app.json
  - tsconfig.node.json
  - index.html
  - src/main.tsx
  - src/App.tsx
  - src/App.css
  - src/index.css
  - src/vite-env.d.ts
  - .gitignore
  - .github/workflows/deploy.yml
autonomous: false

must_haves:
  truths:
    - "npm run dev starts dev server with hot module replacement on localhost"
    - "npm run build completes without errors producing dist/ directory"
    - "npm run preview serves the built app at /cv-page/ base path"
    - "GitHub Actions workflow exists and targets main branch pushes"
    - "GitHub Pages source is configured for GitHub Actions deployment"
  artifacts:
    - path: "vite.config.ts"
      provides: "Vite config with correct base path"
      contains: "base: '/cv-page/'"
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions deployment workflow"
      contains: "deploy-pages@v4"
    - path: "package.json"
      provides: "Project manifest with build scripts"
      contains: "vite build"
    - path: "src/App.tsx"
      provides: "Root React component"
      contains: "function App"
    - path: "index.html"
      provides: "Entry HTML file"
      contains: "root"
  key_links:
    - from: "index.html"
      to: "src/main.tsx"
      via: "script module import"
      pattern: "src/main\\.tsx"
    - from: "src/main.tsx"
      to: "src/App.tsx"
      via: "React render"
      pattern: "import App"
    - from: ".github/workflows/deploy.yml"
      to: "dist/"
      via: "upload-pages-artifact path"
      pattern: "path.*dist"
    - from: "vite.config.ts"
      to: "GitHub Pages URL"
      via: "base path config"
      pattern: "base.*cv-page"
---

<objective>
Initialize a Vite + React + TypeScript project with correct GitHub Pages base path configuration and create a GitHub Actions deployment workflow. This establishes the complete development-to-deployment pipeline for the CV portfolio site.

Purpose: Phase 1 delivers a working deployment pipeline so every subsequent phase can ship instantly. Without this foundation, nothing reaches users.
Output: A buildable React app deployed to GitHub Pages via GitHub Actions on every push to main.
</objective>

<execution_context>
@/home/dethon/.claude/get-shit-done/workflows/execute-plan.md
@/home/dethon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-deployment/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Vite + React + TypeScript project with correct base path</name>
  <files>
    package.json
    package-lock.json
    vite.config.ts
    tsconfig.json
    tsconfig.app.json
    tsconfig.node.json
    index.html
    src/main.tsx
    src/App.tsx
    src/App.css
    src/index.css
    src/vite-env.d.ts
    .gitignore
  </files>
  <action>
    IMPORTANT: The project must be initialized IN the current repo root (/home/dethon/repos/cv-page), NOT in a subdirectory. The repo already exists with .git and .planning directories.

    Steps:
    1. Run `npm create vite@latest . -- --template react-ts` from the repo root. The `.` tells Vite to scaffold into the current directory (it will prompt about non-empty directory -- use `--force` or `--yes` flag if needed, or try `npm create vite@latest tmp-scaffold -- --template react-ts` then move files if the CLI refuses to scaffold into non-empty dir).

       If scaffolding into current dir fails, use this fallback:
       ```
       cd /home/dethon/repos/cv-page
       npm create vite@latest tmp-scaffold -- --template react-ts
       # Move all files from tmp-scaffold/ to repo root (excluding .git, .planning, cv.pdf)
       cp -r tmp-scaffold/* tmp-scaffold/.gitignore .
       rm -rf tmp-scaffold
       ```

    2. Run `npm install` to generate node_modules and package-lock.json.

    3. Edit vite.config.ts to set the GitHub Pages base path. This is CRITICAL -- without it, deployment shows a blank page:
       ```typescript
       import { defineConfig } from 'vite'
       import react from '@vitejs/plugin-react'

       export default defineConfig({
         plugins: [react()],
         base: '/cv-page/',
       })
       ```

    4. Verify .gitignore includes at minimum: node_modules, dist, dist-ssr, *.local. Merge with any existing .gitignore content (the repo already has a .gitignore).

    5. Clean up the default Vite template in src/App.tsx: Replace the Vite+React demo content with a minimal placeholder that confirms the app works:
       ```tsx
       function App() {
         return (
           <div>
             <h1>CV Portfolio</h1>
             <p>Juan Francisco Crespo Galan</p>
           </div>
         )
       }

       export default App
       ```

    6. Clean up src/App.css: Remove all default Vite demo styles, leave file empty or with a single comment.

    7. Clean up src/index.css: Keep only a minimal CSS reset (box-sizing, margin/padding reset, font-family). Remove Vite demo styles.

    8. Verify src/main.tsx renders App into the root div (should be correct from template, just confirm).

    Do NOT modify tsconfig files -- Vite template defaults are optimized.
    Do NOT add any extra dependencies -- Phase 1 is bare infrastructure only.
  </action>
  <verify>
    Run `npm run dev` and confirm dev server starts on localhost (port 5173 by default). The terminal should show "VITE vX.X.X ready" with a local URL. Kill the server after confirming.

    Run `npm run build` and confirm it exits with code 0 and produces a dist/ directory containing index.html and assets/.

    Verify vite.config.ts contains `base: '/cv-page/'` (grep for it).
  </verify>
  <done>
    - Vite dev server starts successfully with HMR
    - Production build completes without errors
    - vite.config.ts has base: '/cv-page/' configured
    - src/App.tsx shows "CV Portfolio" placeholder (not Vite demo)
    - .gitignore covers node_modules and dist
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions workflow and configure Pages deployment</name>
  <files>
    .github/workflows/deploy.yml
  </files>
  <action>
    1. Create the directory structure: `.github/workflows/`

    2. Create `.github/workflows/deploy.yml` with the following exact content (from research -- these are the verified latest action versions):

       ```yaml
       name: Deploy to GitHub Pages

       on:
         push:
           branches: ['main']
         workflow_dispatch:

       permissions:
         contents: read
         pages: write
         id-token: write

       concurrency:
         group: 'pages'
         cancel-in-progress: true

       jobs:
         deploy:
           environment:
             name: github-pages
             url: ${{ steps.deployment.outputs.page_url }}
           runs-on: ubuntu-latest
           steps:
             - name: Checkout
               uses: actions/checkout@v5

             - name: Set up Node
               uses: actions/setup-node@v6
               with:
                 node-version: lts/*
                 cache: 'npm'

             - name: Install dependencies
               run: npm ci

             - name: Build
               run: npm run build

             - name: Setup Pages
               uses: actions/configure-pages@v5

             - name: Upload artifact
               uses: actions/upload-pages-artifact@v4
               with:
                 path: './dist'

             - name: Deploy to GitHub Pages
               id: deployment
               uses: actions/deploy-pages@v4
       ```

    3. Configure GitHub Pages to use GitHub Actions as the source. Try using the gh CLI:
       ```bash
       gh api repos/{owner}/{repo}/pages -X PUT -f build_type=workflow
       ```
       If the Pages endpoint doesn't exist yet (404), first enable Pages:
       ```bash
       gh api repos/{owner}/{repo}/pages -X POST -f build_type=workflow -f source='{"branch":"main","path":"/"}'
       ```
       If gh CLI auth fails, note this in the summary -- the user will need to manually go to Settings > Pages > Source > GitHub Actions.

    4. Run the local build verification cycle:
       ```bash
       npm run build
       npm run preview
       ```
       Check that preview serves at `http://localhost:4173/cv-page/` (note the base path in the URL).
       The page should show the "CV Portfolio" placeholder, not a blank page.
       Kill the preview server after confirming.

    5. Verify the workflow YAML is valid (no syntax errors) by checking it parses:
       ```bash
       cat .github/workflows/deploy.yml | python3 -c "import sys, yaml; yaml.safe_load(sys.stdin)" 2>/dev/null || echo "YAML validation skipped (no pyyaml)"
       ```
       If python3/pyyaml unavailable, visual inspection is sufficient.
  </action>
  <verify>
    Confirm .github/workflows/deploy.yml exists with correct content:
    - Contains `actions/deploy-pages@v4`
    - Contains `branches: ['main']`
    - Contains `path: './dist'`
    - Contains all required permissions (contents, pages, id-token)

    Confirm `npm run build && npm run preview` works -- preview should serve at localhost:4173/cv-page/ showing the placeholder page.

    Check GitHub Pages configuration via `gh api repos/{owner}/{repo}/pages` -- should show build_type: "workflow" (or note if manual setup needed).
  </verify>
  <done>
    - .github/workflows/deploy.yml exists with latest action versions (v4/v5/v6)
    - Workflow triggers on push to main and manual dispatch
    - Local build + preview cycle works at /cv-page/ base path
    - GitHub Pages source configured for GitHub Actions (or documented for manual setup)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify deployment pipeline end-to-end</name>
  <what-built>
    Complete Vite + React + TypeScript project with GitHub Actions deployment workflow. The project builds locally and the workflow is configured to deploy to GitHub Pages on push to main.
  </what-built>
  <how-to-verify>
    1. After Claude commits and pushes to main, go to your GitHub repo: https://github.com/Dethon/cv-page
    2. Click the "Actions" tab -- you should see a workflow run in progress or completed
    3. If the workflow succeeded (green checkmark), visit: https://dethon.github.io/cv-page/
    4. You should see the "CV Portfolio" placeholder page with "Juan Francisco Crespo Galan"
    5. If the workflow failed or Pages shows 404:
       - Check repo Settings > Pages > Source is set to "GitHub Actions" (not "Deploy from a branch")
       - If source was wrong, change it and re-run the workflow from the Actions tab
       - Check the workflow logs for any build errors

    Also verify locally:
    6. Run `npm run dev` -- dev server should start with hot reload
    7. Edit src/App.tsx, change the text -- it should update instantly in the browser without refresh
  </how-to-verify>
  <resume-signal>Type "approved" if the site loads at GitHub Pages and dev server works, or describe any issues you see.</resume-signal>
</task>

</tasks>

<verification>
Phase 1 is complete when ALL of the following are true:
1. `npm run dev` starts Vite dev server with HMR on localhost:5173
2. `npm run build` produces dist/ directory without errors
3. `npm run preview` serves the app at localhost:4173/cv-page/ (correct base path)
4. `.github/workflows/deploy.yml` exists and uses latest action versions
5. GitHub Actions workflow runs successfully on push to main
6. Site loads at https://dethon.github.io/cv-page/ showing the placeholder content
7. vite.config.ts has `base: '/cv-page/'` configured
</verification>

<success_criteria>
- React + Vite + TypeScript project initialized with working dev server (HMR confirmed)
- Production build succeeds and preview serves at correct base path /cv-page/
- GitHub Actions workflow deployed to GitHub Pages successfully
- Live site accessible at dethon.github.io/cv-page showing "CV Portfolio" placeholder
- All future pushes to main will auto-deploy via GitHub Actions
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-deployment/01-01-SUMMARY.md`
</output>
